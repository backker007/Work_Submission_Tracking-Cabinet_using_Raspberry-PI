# ЁЯзк Node-RED Testing Guide

р╣Ар╕нр╕Бр╕кр╕▓р╕гр╕Щр╕╡р╣Йр╣Гр╕Кр╣Йр╕кр╕│р╕лр╕гр╕▒р╕Ър╕Чр╕Фр╕кр╕нр╕Ър╕гр╕░р╕Ър╕Ъ **SmartLocker** р╣Вр╕Фр╕вр╣Др╕бр╣Ир╕Хр╣Йр╕нр╕Зр╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕нр╕Бр╕▒р╕Ъ frontend р╕Ир╕гр╕┤р╕З р╣Вр╕Фр╕вр╣Гр╕Кр╣Йр╣Ар╕Др╕гр╕╖р╣Ир╕нр╕Зр╕бр╕╖р╕н Node-RED р╕Ьр╣Ир╕▓р╕Щ MQTT
р╣Ар╕лр╕бр╕▓р╕░р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╕Юр╕▒р╕Тр╕Щр╕▓р╣Ар╕гр╕┤р╣Ир╕бр╕Хр╣Йр╕Щ р╕лр╕гр╕╖р╕нр╕Бр╕▓р╕г debug р╕нр╕╕р╕Ыр╕Бр╕гр╕Ур╣Мр╕Ър╕Щ Raspberry Pi

---

## ЁЯЪА р╕Др╕╕р╕Ур╕кр╕▓р╕бр╕▓р╕гр╕Цр╕Чр╕│р╕нр╕░р╣Др╕гр╣Др╕Фр╣Йр╕Ър╣Йр╕▓р╕Зр╕Фр╣Йр╕зр╕в Node-RED:
- тЬЕ р╣Бр╕кр╕Фр╕Зр╕Ьр╕е status / warning р╕Вр╕нр╕З slot р╕Ьр╣Ир╕▓р╕Щ MQTT
- тЬЕ р╕кр╣Ир╕Зр╕Др╕│р╕кр╕▒р╣Ир╕Зр╕Чр╕Фр╕кр╕нр╕Ър╣Ар╕Ыр╕┤р╕Фр╕Кр╣Ир╕нр╕З / р╕Ыр╕ер╕Фр╕ер╣Зр╕нр╕Б р╕Ьр╣Ир╕▓р╕Щ MQTT inject
- тЬЕ р╕Ир╕│р╕ер╕нр╕Зр╕Бр╕▓р╕гр╕Чр╕│р╕Зр╕▓р╕Щр╕Вр╕нр╕З web app р╣Др╕Фр╣Йр╣Вр╕Фр╕вр╣Др╕бр╣Ир╕Хр╣Йр╕нр╕Зр╕бр╕╡ UI р╕Ир╕гр╕┤р╕З
- тЬЕ р╣Гр╕Кр╣Й UI Dashboard р╣Ар╕Юр╕╖р╣Ир╕нр╕Фр╕╣р╕кр╕Цр╕▓р╕Щр╕░р╣Бр╕ер╕░р╕Др╕зр╕Ър╕Др╕╕р╕бр╣Др╕Фр╣Йр╕Ьр╣Ир╕▓р╕Щр╕лр╕Щр╣Йр╕▓р╣Ар╕зр╣Зр╕Ъ

---

## ЁЯФз р╕Бр╕▓р╕гр╕Хр╕┤р╕Фр╕Хр╕▒р╣Йр╕З Node-RED
р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╣Гр╕лр╣Йр╣Бр╕Щр╣Ир╣Гр╕Ир╕зр╣Ир╕▓р╕бр╕╡ Node.js р╣Бр╕ер╕░ npm р╣Бр╕ер╣Йр╕з р╕Ир╕▓р╕Бр╕Щр╕▒р╣Йр╕Щр╕Хр╕┤р╕Фр╕Хр╕▒р╣Йр╕З Node-RED:
```bash
sudo npm install -g --unsafe-perm node-red
```
р╣Ар╕гр╕┤р╣Ир╕бр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ:
```bash
node-red
```
р╣Бр╕ер╣Йр╕зр╣Ар╕Ыр╕┤р╕Фр╣Ар╕Ър╕гр╕▓р╕зр╣Мр╣Ар╕Лр╕нр╕гр╣М: `http://localhost:1880`

---

## ЁЯУе р╕Бр╕▓р╕г Import Flow р╕Чр╕Фр╕кр╕нр╕Ъ
1. р╣Ар╕Ыр╕┤р╕Ф Node-RED р╣Гр╕Щр╣Ар╕Ър╕гр╕▓р╕зр╣Мр╣Ар╕Лр╕нр╕гр╣М
2. р╣Ар╕бр╕Щр╕╣р╕бр╕╕р╕бр╕Вр╕зр╕▓р╕Ър╕Щ тЖТ **Import** тЖТ **Clipboard**
3. р╕зр╕▓р╕Зр╣Ар╕Щр╕╖р╣Йр╕нр╕лр╕▓р╕Ир╕▓р╕Б `smartlocker_ui_flow.json`
4. р╕Бр╕Ф **Deploy**

---

## ЁЯзк р╕гр╕▓р╕вр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Ф Flow
### MQTT In:
- `smartlocker/+/slot/+/status` тЖТ р╣Бр╕кр╕Фр╕Зр╕Др╣Ир╕▓р╕Др╕зр╕▓р╕бр╕Ир╕╕р╣Бр╕ер╕░р╕кр╕Цр╕▓р╕Щр╕░р╕Ър╕Щ debug р╕лр╕гр╕╖р╕н UI
- `smartlocker/+/slot/+/warning` тЖТ р╣Бр╕кр╕Фр╕Зр╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щр╣Гр╕Щ debug р╕лр╕гр╕╖р╕н popup

### MQTT Out (р╕Ир╕│р╕ер╕нр╕З Command):
- ЁЯФШ р╕Ыр╕╕р╣Ир╕б Inject: р╕кр╣Ир╕Зр╕Др╕│р╕кр╕▒р╣Ир╕Зр╣Ар╕Ыр╕┤р╕Фр╕Кр╣Ир╕нр╕З 1 (role: `student`)
- ЁЯФШ р╕Ыр╕╕р╣Ир╕б Inject: р╕кр╣Ир╕Зр╕Др╕│р╕кр╕▒р╣Ир╕Зр╕Ыр╕ер╕Фр╕ер╣Зр╕нр╕Бр╕Кр╣Ир╕нр╕З 1 (role: `admin`)

### MQTT Broker:
- р╣Гр╕Кр╣Й `localhost:1883` р╣Ар╕Ыр╣Зр╕Щр╕Др╣Ир╕▓р╣Ар╕гр╕┤р╣Ир╕бр╕Хр╣Йр╕Щ (Mosquitto local)
- р╕лр╕▓р╕Бр╣Гр╕Кр╣Й broker р╕Чр╕╡р╣Ир╕нр╕╖р╣Ир╕Щ р╕кр╕▓р╕бр╕▓р╕гр╕Цр╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╣Др╕Фр╣Йр╣Гр╕Щ MQTT Config Node

---

## ЁЯзСтАНЁЯТ╗ р╣Ар╕Юр╕┤р╣Ир╕б UI Dashboard (Optional)
р╕лр╕▓р╕Бр╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕Фр╕╣р╕кр╕Цр╕▓р╕Щр╕░р╕Ьр╣Ир╕▓р╕Щ UI:

### р╕Хр╕┤р╕Фр╕Хр╕▒р╣Йр╕З Node-RED Dashboard
```bash
cd ~/.node-red
npm install node-red-dashboard
```
р╕Ир╕▓р╕Бр╕Щр╕▒р╣Йр╕Щ restart Node-RED:
```bash
node-red
```

### р╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ Dashboard
- р╕ер╕▓р╕Б nodes р╣Гр╕Щр╕лр╕бр╕зр╕Ф `dashboard` р╕бр╕▓р╕зр╕▓р╕Зр╣Ар╕Кр╣Ир╕Щ:
  - `ui_button` тЖТ р╣Ар╕Ыр╕┤р╕Фр╕Кр╣Ир╕нр╕З / р╕Ыр╕ер╕Фр╕ер╣Зр╕нр╕Б
  - `ui_text` / `ui_gauge` тЖТ р╣Бр╕кр╕Фр╕Зр╕Др╣Ир╕▓р╕Др╕зр╕▓р╕бр╕Ир╕╕
  - `ui_toast` тЖТ р╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щ warning
- р╣Ар╕Юр╕┤р╣Ир╕бр╕лр╕Щр╣Йр╕▓р╣Ар╕зр╣Зр╕Ъ UI р╕Чр╕╡р╣И: `http://localhost:1880/ui`

---

## ЁЯУМ р╕лр╕бр╕▓р╕вр╣Ар╕лр╕Хр╕╕р╣Ар╕Юр╕┤р╣Ир╕бр╣Ар╕Хр╕┤р╕б
- р╕кр╕▓р╕бр╕▓р╕гр╕Цр╣Гр╕Кр╣Й CLI р╕кр╕│р╕лр╕гр╕▒р╕Ър╕кр╣Ир╕З MQTT р╣Бр╕Ър╕Ъ custom р╣Др╕Фр╣Йр╣Ар╕Кр╣Ир╕Щ:
```bash
mosquitto_pub -t "smartlocker/C01/slot/1/command/open" -m '{"role": "student"}'
```

---

## ЁЯУВ Topics р╕Чр╕╡р╣Ир╣Гр╕Кр╣Йр╕Ър╣Ир╕нр╕в
```
smartlocker/C01/slot/1/command/open
smartlocker/C01/slot/1/command/unlock
smartlocker/C01/slot/1/status
smartlocker/C01/slot/1/warning
```

---

## ЁЯУЪ р╣Ар╕нр╕Бр╕кр╕▓р╕гр╣Ар╕Юр╕┤р╣Ир╕бр╣Ар╕Хр╕┤р╕б
- р╕Бр╕▓р╕гр╕Хр╕┤р╕Фр╕Хр╕▒р╣Йр╕Зр╕гр╕░р╕Ър╕Ъ: `setup_instructions.md`
- р╕Др╕╣р╣Ир╕бр╕╖р╕н contribute: `CONTRIBUTING.md`
- р╕Др╕╣р╣Ир╕бр╕╖р╕н Node-RED: `node-red.md`

---

Node-RED р╕Др╕╖р╕нр╣Ар╕Др╕гр╕╖р╣Ир╕нр╕Зр╕бр╕╖р╕нр╕Чр╕Фр╕кр╕нр╕Ър╕гр╕░р╕Ър╕Ър╕Чр╕╡р╣Ир╕Чр╕гр╕Зр╕Юр╕ер╕▒р╕Зр╣Бр╕ер╕░р╕гр╕зр╕Фр╣Ар╕гр╣Зр╕з тЪб  
р╣Ар╕лр╕бр╕▓р╕░р╕Бр╕▒р╕Ър╕Чр╕╡р╕бр╕Юр╕▒р╕Тр╕Щр╕▓р╣Бр╕ер╕░р╕Ьр╕╣р╣Йр╕Фр╕╣р╣Бр╕ер╕гр╕░р╕Ър╕Ър╕Чр╕╡р╣Ир╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╣Бр╕Ър╕Ър╣Др╕бр╣Ир╕Хр╣Йр╕нр╕Зр╕гр╕н UI р╕Ир╕гр╕┤р╕З
