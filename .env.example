# =========================================================
# MQTT (Broker + Transport)
# - ใส่โฮสต์/พอร์ต/บัญชีจากผู้ให้บริการ (เช่น HiveMQ Cloud)
# - TLS: 1 = เปิด (พอร์ตทั่วไป 8883), 0 = ปิด (พอร์ตทั่วไป 1883)
# - MQTT_WS: 1 = MQTT over WebSocket (wss) มักใช้พอร์ต 443
# =========================================================
MQTT_HOST=<YOUR_BROKER_HOSTNAME>            # เช่น xxx.s1.eu.hivemq.cloud
MQTT_PORT=8883
MQTT_USERNAME=<YOUR_USERNAME>
MQTT_PASSWORD=<YOUR_PASSWORD>
MQTT_TLS=1
MQTT_WS=0
MQTT_CLIENT_ID=<NODE_ID>-rpi4               # ต้องไม่ซ้ำกันในระบบ (เช่น C01-rpi4)
MQTT_BASE_TOPIC=smartlocker                 # base topic ที่ระบบใช้ (ค่าเริ่มต้น smartlocker)
# MQTT_CA=/path/to/broker-ca.pem            # ถ้ามี CA แยก ให้ระบุไฟล์ .pem
MQTT_WS_PATH=/mqtt                          # path ของ WebSocket (ถ้าใช้ MQTT_WS=1)

# Backoff/Timeout (ออปชัน)
MQTT_RECONNECT_BASE_S=1.0
MQTT_RECONNECT_MAX_S=32.0
MQTT_PUBLISH_TIMEOUT_S=3.0

# =========================================================
# Locker / Node identity
# =========================================================
CUPBOARD_ID=C01
NODE_ID=C01                                 # ไม่ระบุก็จะเท่ากับ CUPBOARD_ID
SLOT_IDS=SC001,SC002,SC003,SC004

# เวลาท้องถิ่น (สำหรับ stamp ใน payload)
TIME_TZ=Asia/Bangkok
TIME_LABEL=กรุงเทพฯ

# =========================================================
# Sensor thresholds / Global timings
# =========================================================
ZERO_THRESHOLD=70                           # เส้นแบ่ง “ใกล้มาก/ชิดเซนเซอร์”
ACTIVE_CHECK_INTERVAL=0.5                   # รอบเช็กทั่วไป (วินาที)
CHECK_INTERVAL=120                          # รอบ publish สถานะรวม (วินาที)
DOOR_SENSOR_INVERT=0                        # 1 = กลับลอจิก reed switch
SENSOR_MOTION_THRESHOLD=5                   # Δ ระยะที่ถือว่า “ขยับ” ระหว่างเปิดประตู
SENSOR_STABLE_DURATION=1.5                  # เวลาอ่านนิ่งก่อนสรุป (วินาที)
SENSOR_CHECK_INTERVAL=0.2                   # รอบเช็กระหว่างเปิดประตู (วินาที)

# =========================================================
# VL53 (XSHUT mode) — ที่อยู่/พฤติกรรมเซ็นเซอร์
# =========================================================
VL53_BUS_MODE=multi
VL53_XSHUT_PINS=17,27,22,5                  # GPIO ตามบอร์ด (D17,D27,D22,D5)
VL53_BOOT_DELAY_S=0.35
VL53_BUDGET_US=20000
VL53_CONTINUOUS=1
VL53_INIT_ALL_LOW=1
VL53_BASE_ADDR=0x30

# เปิด/ตั้งค่าตัวอ่าน (tuning)
VL53_BOOT_TIMEOUT_S=2.0
VL53_ADDR_SET_RETRIES=8
VL53_ADDR_SET_GAP_S=0.50
VL53_POST_SET_DELAY_S=2.0
VL53_OPEN_RETRIES=12
VL53_OPEN_DELAY_S=0.35
VL53_OPEN_DELAY_PRE_S=0.25
VL53_PROBE_INTERVAL_S=0.12
VL53_HOLD_LOW_S=1.0
VL53_ADOPT_STALE_ADDR=1                      # รับเลี้ยง address เดิมถ้าเจอ
VL53_RECOVER_ON_OPEN_FAIL=1                  # ล้มเหลวแล้ว power-cycle + reassign

# I2C (fallback บางเคส)
I2C_BUS_NUM=1

# =========================================================
# Distance mapping & thresholds
# =========================================================
TARGET_MIN_MM=20                             # < ค่านี้จะ clamp เป็น 0 mm
TARGET_MAX_MM=30
DEFAULT_FULL_THRESHOLD_MM=40                 # ≤ ค่านี้ถือว่า “ช่องเต็ม”
CHANGE_THRESHOLD=5                           # Δ ระยะขั้นต่ำเพื่อถือว่าค่าเปลี่ยน

# =========================================================
# Door timing / Debounce
# =========================================================
DOOR_UNLOCK_WINDOW_S=10
DOOR_DEBOUNCE_OPEN_S=0.5
DOOR_DEBOUNCE_CLOSE_S=0.6
DOOR_SAMPLES=5                               # ตัวอย่างดีบาวน์ reed switch
DOOR_SAMPLE_INTERVAL_S=0.02

# =========================================================
# Solenoid (ประตู)
# - SOLENOID_PULSE_MS = 0 → ค้างไฟจนกว่าจะสั่งตัด
# - >0 → จ่ายพัลส์ x ms แล้วตัดทันที
# - SOLENOID_KEEP_ON_WHILE_OPEN = 1 → ค้างไฟระหว่างที่ประตูเปิดอยู่
# =========================================================
SOLENOID_PULSE_MS=0
SOLENOID_KEEP_ON_WHILE_OPEN=0

# =========================================================
# Motion / Warning (ระหว่างประตูเปิด)
# =========================================================
MOTION_TIMEOUT=30
MOTION_INACTIVE_BEFORE_WARN=5
TIME_REPEAT_WARNING=10

# =========================================================
# Servo (PCA9685)
# =========================================================
SERVO_SETTLE_S=0.7                            # เวลารอให้หมุนจบก่อนตัด PWM

# =========================================================
# Status LEDs on MCP23017 (index ตาม SLOT_IDS)
# =========================================================
SLOT_LED_READY_PINS=0,1,2,3
SLOT_LED_ERROR_PINS=4,5,6,7
SLOT_LED_ACTIVE_HIGH=1

# =========================================================
# Logging
# =========================================================
LOG_LEVEL=INFO                                # DEBUG/INFO/WARNING/ERROR
